<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>mediationverse Package Development ‚Ä¢ mediationverse</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="deps/Montserrat-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="mediationverse Package Development"><meta property="og:image" content="https://data-wise.github.io/mediationverse/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mediationverse</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html" aria-label="Home"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ecosystem Overview</h6></li>
    <li><a class="dropdown-item" href="articles/mediationverse-workflow.html">mediationverse Workflow</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-ecosystem" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Ecosystem</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-ecosystem"><li><h6 class="dropdown-header" data-toc-skip>Core Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://data-wise.github.io/medfit/">medfit (Foundation)</a></li>
    <li><a class="external-link dropdown-item" href="https://data-wise.github.io/probmed/">probmed (P_med Effect Size)</a></li>
    <li><a class="external-link dropdown-item" href="https://data-wise.github.io/rmediation/">RMediation (Confidence Intervals)</a></li>
    <li><a class="external-link dropdown-item" href="https://data-wise.github.io/medrobust/">medrobust (Sensitivity Analysis)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Support Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://data-wise.github.io/medsim/">medsim (Simulation Infrastructure)</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-status" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chart-line"></span> Status</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-status"><li><a class="external-link dropdown-item" href="https://github.com/data-wise/mediationverse/blob/main/STATUS.md">üìä Package Status Dashboard</a></li>
    <li><a class="dropdown-item" href="articles/roadmap.html">üó∫Ô∏è Development Roadmap</a></li>
    <li><a class="dropdown-item" href="articles/contributing.html">ü§ù Contributing Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="external-link dropdown-item" href="https://github.com/data-wise/medfit/blob/main/planning/ECOSYSTEM.md">üìã Ecosystem Coordination</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/data-wise/mediationverse" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>mediationverse Package Development</h1>
      <small class="dont-index">Source: <a href="https://github.com/data-wise/mediationverse/blob/dev/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="mediationverse-package-development" class="section level1">

<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p>mediationverse is a comprehensive R package ecosystem for causal mediation analysis. Core principles: - <strong>Unified interface</strong>: Consistent API across different mediation methods - <strong>Modern R</strong>: S7 object system, tidyverse-compatible - <strong>Rigorous methods</strong>: Implement state-of-art causal inference techniques - <strong>Pedagogical</strong>: Clear documentation for applied researchers</p>
</div>
<div class="section level2">
<h2 id="essential-commands">Essential Commands<a class="anchor" aria-label="anchor" href="#essential-commands"></a></h2>
<div class="section level3">
<h3 id="development-workflow">Development Workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span>           <span class="co"># Load package during development (Cmd+Shift+L in RStudio)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span>               <span class="co"># Run test suite (Cmd+Shift+T)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span>              <span class="co"># R CMD check (Cmd+Shift+E)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span>           <span class="co"># Update docs from roxygen2 (Cmd+Shift+D)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span>              <span class="co"># Build package tarball</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing--coverage">Testing &amp; Coverage<a class="anchor" aria-label="anchor" href="#testing--coverage"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test_active_file</span><span class="op">(</span><span class="op">)</span>   <span class="co"># Test current file only</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-mediation.R"</span><span class="op">)</span></span>
<span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span>       <span class="co"># Must maintain &gt;80% coverage</span></span>
<span><span class="fu">covr</span><span class="fu">::</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span>                 <span class="co"># View coverage report in browser</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-quality">Code Quality<a class="anchor" aria-label="anchor" href="#code-quality"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">styler</span><span class="fu">::</span><span class="fu">style_pkg</span><span class="op">(</span><span class="op">)</span>            <span class="co"># Auto-format to tidyverse style</span></span>
<span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span>          <span class="co"># Static code analysis</span></span>
<span><span class="fu">spelling</span><span class="fu">::</span><span class="fu">spell_check_package</span><span class="op">(</span><span class="op">)</span> <span class="co"># Check spelling in docs</span></span>
<span><span class="fu">goodpractice</span><span class="fu">::</span><span class="fu">gp</span><span class="op">(</span><span class="op">)</span>             <span class="co"># Comprehensive package checks</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span>          <span class="co"># Build package website</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_reference.html" class="external-link">build_reference</a></span><span class="op">(</span><span class="op">)</span>     <span class="co"># Just rebuild function reference</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_vignette</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>  <span class="co"># Create new vignette</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="r-code-standards">R Code Standards<a class="anchor" aria-label="anchor" href="#r-code-standards"></a></h2>
<div class="section level3">
<h3 id="package-structure-requirements">Package Structure Requirements<a class="anchor" aria-label="anchor" href="#package-structure-requirements"></a></h3>
<ul><li>
<strong>NEVER</strong> use <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> or <code><a href="https://rdrr.io/r/base/library.html" class="external-link">require()</a></code> inside package code</li>
<li>
<strong>ALWAYS</strong> use <code>::</code> notation for external functions (e.g., <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>)</li>
<li>
<strong>ALWAYS</strong> use <code>@importFrom</code> or <code>@import</code> in roxygen2 for dependencies</li>
<li>All dependencies must be in DESCRIPTION file (Imports or Suggests)</li>
</ul></div>
<div class="section level3">
<h3 id="s7-object-system-guidelines">S7 Object System Guidelines<a class="anchor" aria-label="anchor" href="#s7-object-system-guidelines"></a></h3>
<div class="section level4">
<h4 id="class-definitions">Class Definitions<a class="anchor" aria-label="anchor" href="#class-definitions"></a></h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GOOD - Complete S7 class with validator</span></span>
<span><span class="va">MediationResult</span> <span class="op">&lt;-</span> <span class="fu">new_class</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"MediationResult"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    direct_effect <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    indirect_effect <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    total_effect <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    standard_errors <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    confidence_intervals <span class="op">=</span> <span class="va">class_matrix</span></span>
<span>  <span class="op">)</span>,</span>
<span>  validator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># CRITICAL: Always include validators</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">standard_errors</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Standard errors cannot be empty"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">standard_errors</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Standard errors must be non-negative"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">direct_effect</span>, <span class="va">self</span><span class="op">@</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Effects must be finite"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BAD - Missing validator</span></span>
<span><span class="va">BadClass</span> <span class="op">&lt;-</span> <span class="fu">new_class</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"BadClass"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span></span>
<span>  <span class="co"># Missing validator!</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="method-definitions">Method Definitions<a class="anchor" aria-label="anchor" href="#method-definitions"></a></h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GOOD - Proper generic and method</span></span>
<span><span class="fu">method</span><span class="op">(</span><span class="va">print</span>, <span class="va">MediationResult</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mediation Analysis Results\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Direct Effect:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">direct_effect</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Indirect Effect:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">indirect_effect</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># BAD - Using old S3 style in S7 package</span></span>
<span><span class="va">print.MediationResult</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span>  <span class="co"># Don't do this!</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="function-documentation-roxygen2">Function Documentation (roxygen2)<a class="anchor" aria-label="anchor" href="#function-documentation-roxygen2"></a></h3>
<p>EVERY exported function MUST include:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title Brief one-line description</span></span>
<span><span class="co">#' @description Longer description with statistical details</span></span>
<span><span class="co">#' @param outcome Character. Name of outcome variable</span></span>
<span><span class="co">#' @param mediator Character. Name of mediator variable</span></span>
<span><span class="co">#' @param treatment Character. Name of treatment variable</span></span>
<span><span class="co">#' @param data Data frame containing all variables</span></span>
<span><span class="co">#' @return S7 object of class MediationResult containing:</span></span>
<span><span class="co">#'   \item{direct_effect}{Natural direct effect estimate}</span></span>
<span><span class="co">#'   \item{indirect_effect}{Natural indirect effect estimate}</span></span>
<span><span class="co">#'   \item{standard_errors}{Bootstrap standard errors}</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#'   # Simulate data</span></span>
<span><span class="co">#'   set.seed(123)</span></span>
<span><span class="co">#'   n &lt;- 500</span></span>
<span><span class="co">#'   data &lt;- simulate_mediation_data(n = n)</span></span>
<span><span class="co">#'   </span></span>
<span><span class="co">#'   # Fit mediation model</span></span>
<span><span class="co">#'   fit &lt;- mediate(</span></span>
<span><span class="co">#'     outcome = "Y",</span></span>
<span><span class="co">#'     mediator = "M", </span></span>
<span><span class="co">#'     treatment = "A",</span></span>
<span><span class="co">#'     data = data</span></span>
<span><span class="co">#'   )</span></span>
<span><span class="co">#'   print(fit)</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' @references </span></span>
<span><span class="co">#' VanderWeele, T. J. (2015). Explanation in Causal Inference: Methods for </span></span>
<span><span class="co">#' Mediation and Interaction. Oxford University Press.</span></span>
<span><span class="co">#' @export</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-style-tidyverse">Code Style (tidyverse)<a class="anchor" aria-label="anchor" href="#code-style-tidyverse"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GOOD</span></span>
<span><span class="va">calculate_natural_effects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">mediator</span>, <span class="va">treatment</span>, </span>
<span>                                      <span class="va">data</span>, <span class="va">confounders</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Input validation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">mediator</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mediator</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Clear variable names</span></span>
<span>  <span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">fit_outcome_model</span><span class="op">(</span><span class="va">data</span>, <span class="va">outcome</span>, <span class="va">mediator</span>, <span class="va">treatment</span><span class="op">)</span></span>
<span>  <span class="va">mediator_model</span> <span class="op">&lt;-</span> <span class="fu">fit_mediator_model</span><span class="op">(</span><span class="va">data</span>, <span class="va">mediator</span>, <span class="va">treatment</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Compute effects</span></span>
<span>  <span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu">compute_effects</span><span class="op">(</span><span class="va">outcome_model</span>, <span class="va">mediator_model</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># BAD - Poor style</span></span>
<span><span class="va">calcNatEff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>,<span class="va">m</span>,<span class="va">a</span>,<span class="va">d</span>,<span class="va">c</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Unclear names</span></span>
<span>  <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span>,<span class="va">y</span><span class="op">]</span><span class="op">~</span><span class="va">d</span><span class="op">[</span>,<span class="va">m</span><span class="op">]</span><span class="op">+</span><span class="va">d</span><span class="op">[</span>,<span class="va">a</span><span class="op">]</span><span class="op">)</span>  <span class="co"># No spaces, unclear</span></span>
<span>  <span class="co"># No input validation</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing-standards">Testing Standards<a class="anchor" aria-label="anchor" href="#testing-standards"></a></h2>
<div class="section level3">
<h3 id="test-structure-testthat3">Test Structure (testthat3)<a class="anchor" aria-label="anchor" href="#test-structure-testthat3"></a></h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tests/testthat/test-mediation.R</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"mediate() handles continuous mediator correctly"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Arrange</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">simulate_continuous_mediator</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Act</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">mediate</span><span class="op">(</span></span>
<span>    outcome <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>    mediator <span class="op">=</span> <span class="st">"M"</span>,</span>
<span>    treatment <span class="op">=</span> <span class="st">"A"</span>, </span>
<span>    data <span class="op">=</span> <span class="va">data</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Assert</span></span>
<span>  <span class="fu">expect_s7_class</span><span class="op">(</span><span class="va">result</span>, <span class="st">"MediationResult"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">result</span><span class="op">@</span><span class="va">direct_effect</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">result</span><span class="op">@</span><span class="va">indirect_effect</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_length</span><span class="op">(</span><span class="va">result</span><span class="op">@</span><span class="va">standard_errors</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"mediate() throws error with missing data"</span>, <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">expect_error</span><span class="op">(</span></span>
<span>    <span class="fu">mediate</span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"Y"</span>, mediator <span class="op">=</span> <span class="st">"M"</span>, treatment <span class="op">=</span> <span class="st">"A"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>    <span class="st">"Missing values detected"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="critical-edge-cases-to-test">Critical Edge Cases to Test<a class="anchor" aria-label="anchor" href="#critical-edge-cases-to-test"></a></h3>
<p><strong>ALWAYS</strong> test these scenarios: - Missing data (NA values) - Zero variance in variables - Perfect collinearity - Singular covariance matrices - Empty data frames - Single observation - Character vs factor variables - Different treatment types (binary, continuous, categorical) - Confounders with missing values - Interaction terms - Non-standard variable names (spaces, special characters)</p>
</div>
<div class="section level3">
<h3 id="snapshot-testing">Snapshot Testing<a class="anchor" aria-label="anchor" href="#snapshot-testing"></a></h3>
<p>For complex output:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"print method produces correct output"</span>, <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">create_test_mediation_result</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">expect_snapshot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="statistical-requirements">Statistical Requirements<a class="anchor" aria-label="anchor" href="#statistical-requirements"></a></h2>
<div class="section level3">
<h3 id="identification-assumptions">Identification Assumptions<a class="anchor" aria-label="anchor" href="#identification-assumptions"></a></h3>
<p>EVERY mediation function MUST clearly document required assumptions: 1. <strong>Sequential ignorability</strong>: No unmeasured confounding 2. <strong>Positivity</strong>: All combinations of treatment/mediator have positive probability 3. <strong>Consistency</strong>: Well-defined interventions 4. <strong>Cross-world independence</strong> (for natural effects)</p>
<p>Include assumption checking functions where possible:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_positivity</span><span class="op">(</span><span class="va">data</span>, <span class="va">treatment</span>, <span class="va">mediator</span><span class="op">)</span></span>
<span><span class="fu">assess_overlap</span><span class="op">(</span><span class="va">data</span>, <span class="va">treatment</span>, <span class="va">confounders</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="effect-measures">Effect Measures<a class="anchor" aria-label="anchor" href="#effect-measures"></a></h3>
<p>Use standard notation from VanderWeele (2015): - <strong>NDE</strong>: Natural Direct Effect - <strong>NIE</strong>: Natural Indirect Effect<br>
- <strong>TE</strong>: Total Effect (TE = NDE + NIE under rare outcome assumption) - <strong>PM</strong>: Proportion Mediated</p>
</div>
<div class="section level3">
<h3 id="inference-methods">Inference Methods<a class="anchor" aria-label="anchor" href="#inference-methods"></a></h3>
<p>Support multiple inference approaches: - <strong>Delta method</strong>: Fast, asymptotic - <strong>Bootstrap</strong>: Robust, computationally intensive - Use <code>boot</code> package with <code>parallel = "multicore"</code> - Default B = 1000, allow user to specify - <strong>Monte Carlo</strong>: For complex mediation models - <strong>Bayesian</strong>: Via <code>brms</code> or <code>rstan</code> interfaces (future)</p>
</div>
</div>
<div class="section level2">
<h2 id="common-pitfalls-to-avoid">Common Pitfalls to Avoid<a class="anchor" aria-label="anchor" href="#common-pitfalls-to-avoid"></a></h2>
<div class="section level3">
<h3 id="id_-dont-do-this">‚ùå DON‚ÄôT DO THIS<a class="anchor" aria-label="anchor" href="#id_-dont-do-this"></a></h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using library() in package code</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>  <span class="co"># WRONG!</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Modifying global options without reset</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>  <span class="co"># Will affect user's R session!</span></span>
<span>  <span class="co"># ... code ...</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Using T/F instead of TRUE/FALSE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span>  <span class="co"># WRONG! T can be overwritten</span></span>
<span></span>
<span><span class="co"># Partial matching in data frame subsetting</span></span>
<span><span class="va">data</span><span class="op">[</span>, <span class="st">"outcome"</span><span class="op">]</span>  <span class="co"># Can be ambiguous</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_-do-this-instead">‚úÖ DO THIS INSTEAD<a class="anchor" aria-label="anchor" href="#id_-do-this-instead"></a></h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use :: notation</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">data</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Save and restore options</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># ... code ...</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use TRUE/FALSE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span></span>
<span></span>
<span><span class="co"># Exact column matching</span></span>
<span><span class="va">data</span><span class="op">[</span>, <span class="st">"outcome"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="git-workflow">Git Workflow<a class="anchor" aria-label="anchor" href="#git-workflow"></a></h2>
<div class="section level3">
<h3 id="branch-naming">Branch Naming<a class="anchor" aria-label="anchor" href="#branch-naming"></a></h3>
<ul><li>
<code>feature/natural-effects-s7</code> - New features</li>
<li>
<code>fix/bootstrap-ci-bug</code> - Bug fixes</li>
<li>
<code>refactor/mediator-models</code> - Code refactoring</li>
<li>
<code>docs/vignette-sensitivity</code> - Documentation</li>
<li>
<code>test/edge-cases-missing-data</code> - Test additions</li>
</ul></div>
<div class="section level3">
<h3 id="commit-messages">Commit Messages<a class="anchor" aria-label="anchor" href="#commit-messages"></a></h3>
<pre><code>feat: Add multiply robust mediation estimator

- Implement doubly robust outcome regression
- Add inverse probability weighting for mediator
- Include 95% CIs via bootstrap (B=1000)
- Add tests for continuous and binary mediators
- Update vignette with new example

Closes #42</code></pre>
</div>
<div class="section level3">
<h3 id="never-commit">Never Commit<a class="anchor" aria-label="anchor" href="#never-commit"></a></h3>
<ul><li>
<code>.Rproj.user/</code> - RStudio user files</li>
<li>
<code>.Rhistory</code> - Command history</li>
<li>
<code>.RData</code> - Workspace data</li>
<li>
<code>*.Rcheck/</code> - Check output</li>
<li>Personal notes in <code>.Rmd</code> files</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a></h2>
<div class="section level3">
<h3 id="vectorization">Vectorization<a class="anchor" aria-label="anchor" href="#vectorization"></a></h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GOOD - Vectorized</span></span>
<span><span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">Y1</span> <span class="op">-</span> <span class="va">Y0</span><span class="op">)</span> <span class="op">*</span> <span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BAD - Slow loop</span></span>
<span><span class="va">effects</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">Y1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">effects</span> <span class="op">&lt;-</span> <span class="va">effects</span> <span class="op">+</span> <span class="op">(</span><span class="va">Y1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">Y0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">weights</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">effects</span> <span class="op">&lt;-</span> <span class="va">effects</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="large-datasets">Large Datasets<a class="anchor" aria-label="anchor" href="#large-datasets"></a></h3>
<ul><li>Use <code>data.table</code> for n &gt; 100,000</li>
<li>Consider <code>collapse</code> package for grouped operations</li>
<li>Profile with <code>profvis::profvis()</code>
</li>
<li>Use <code>bench::mark()</code> to compare implementations</li>
</ul></div>
<div class="section level3">
<h3 id="bootstrap-parallelization">Bootstrap Parallelization<a class="anchor" aria-label="anchor" href="#bootstrap-parallelization"></a></h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Template for parallel bootstrap</span></span>
<span><span class="va">bootstrap_ci</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">B</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">parallel</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ncores</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">parallel</span><span class="op">)</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="va">boot_results</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">boot_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span>      <span class="fu">compute_effect</span><span class="op">(</span><span class="va">boot_data</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    mc.cores <span class="op">=</span> <span class="va">ncores</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">boot_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="documentation-website-pkgdown">Documentation Website (pkgdown)<a class="anchor" aria-label="anchor" href="#documentation-website-pkgdown"></a></h2>
<div class="section level3">
<h3 id="id__pkgdownyml-structure">_pkgdown.yml Structure<a class="anchor" aria-label="anchor" href="#id__pkgdownyml-structure"></a></h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="at">  </span><span class="fu">bootstrap</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">reference</span><span class="kw">:</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Main Functions"</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="at">    </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">"Core mediation analysis functions"</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mediate</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mediate_bootstrap</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Effect Measures"</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> natural_direct_effect</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> natural_indirect_effect</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Sensitivity Analysis"</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> sensitivity_analysis</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> evalue_mediation</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="when-working-with-claude-code">When Working with Claude Code<a class="anchor" aria-label="anchor" href="#when-working-with-claude-code"></a></h2>
<div class="section level3">
<h3 id="explicitly-state-goals">Explicitly State Goals<a class="anchor" aria-label="anchor" href="#explicitly-state-goals"></a></h3>
<p>Instead of: ‚ÄúFix the mediation function‚Äù Use: ‚ÄúThe natural_direct_effect() function gives incorrect CIs when using bootstrap with B=1000. The issue appears to be in how we‚Äôre computing the percentile intervals. Please review the bootstrap_ci() helper function and fix the quantile calculation.‚Äù</p>
</div>
<div class="section level3">
<h3 id="request-verification">Request Verification<a class="anchor" aria-label="anchor" href="#request-verification"></a></h3>
<p>After changes: ‚ÄúRun the test suite and confirm all tests pass. Then run a simple example to verify the bootstrap CIs look reasonable.‚Äù</p>
</div>
<div class="section level3">
<h3 id="use-iterative-development">Use Iterative Development<a class="anchor" aria-label="anchor" href="#use-iterative-development"></a></h3>
<ol style="list-style-type: decimal"><li>‚ÄúRead the current mediate() function implementation‚Äù</li>
<li>‚ÄúCreate a plan for adding multiply robust estimation without breaking existing functionality‚Äù</li>
<li>‚ÄúImplement the multiply robust estimator following our S7 class structure‚Äù</li>
<li>‚ÄúWrite comprehensive tests including edge cases‚Äù</li>
<li>‚ÄúUpdate documentation with new parameter and examples‚Äù</li>
<li>‚ÄúRun R CMD check and fix any issues‚Äù</li>
</ol></div>
<div class="section level3">
<h3 id="reference-key-files">Reference Key Files<a class="anchor" aria-label="anchor" href="#reference-key-files"></a></h3>
<p>‚ÄúLook at how we implemented the bootstrap CI in <code>R/bootstrap.R</code> lines 45-67. Use that same pattern for the new sensitivity analysis function.‚Äù</p>
</div>
</div>
<div class="section level2">
<h2 id="quick-reference-links">Quick Reference Links<a class="anchor" aria-label="anchor" href="#quick-reference-links"></a></h2>
<ul><li><a href="https://rconsortium.github.io/S7/" class="external-link">S7 Documentation</a></li>
<li><a href="https://r-pkgs.org/" class="external-link">R Packages Book</a></li>
<li><a href="https://style.tidyverse.org/" class="external-link">Tidyverse Style Guide</a></li>
<li>
<a href="https://doi.org/10.1093/aje/kwv034" class="external-link">VanderWeele (2015)</a> - Mediation methods</li>
<li>
<a href="https://github.com/your-username/RMediation" class="external-link">RMediation Package</a> - Our related work</li>
</ul></div>
<div class="section level2">
<h2 id="common-commands-shortlist">Common Commands Shortlist<a class="anchor" aria-label="anchor" href="#common-commands-shortlist"></a></h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Development cycle</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::load_all(); devtools::test(); devtools::check()"</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co"># Before committing</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"styler::style_pkg(); lintr::lint_package(); spelling::spell_check_package()"</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co"># Documentation</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::document(); pkgdown::build_site()"</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co"># Coverage report</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"covr::report()"</span></span></code></pre></div>
<hr><p><strong>Last Updated</strong>: 2025-12-05 <strong>Maintainer</strong>: Update this file as patterns emerge!</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0001-8523-7776" class="external-link">Davood Tofighi</a> Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Version {version}</p>
</div>

    </footer></div>





  </body></html>

